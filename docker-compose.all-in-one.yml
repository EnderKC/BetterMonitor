services:
  better-monitor:
    build:
      context: .
      dockerfile: Dockerfile.all-in-one
      args:
        VERSION: ${VERSION:-1.0.6}
        BUILD_DATE: ${BUILD_DATE:-$(date +%Y-%m-%d)}
    container_name: better-monitor
    restart: unless-stopped
    ports:
      - "3333:3333"
    volumes:
      - ./data:/app/data:rw
      - ./logs:/app/logs:rw
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - TZ=Asia/Shanghai
      - JWT_SECRET=${JWT_SECRET:-your_jwt_secret_key_change_this_in_production}
      - VERSION=${VERSION:-1.0.6}
    security_opt:
      - no-new-privileges:true
    read_only: false
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3333/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s 
